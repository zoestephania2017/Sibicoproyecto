# Copyright (c) 2023 Bodega Copeco
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.

RewriteEngine On
RewriteBase /

ErrorDocument 403 /BodegaCopeco/error/forbidden.php
ErrorDocument 404 /BodegaCopeco/error/not_found.php
ErrorDocument 500 /BodegaCopeco/error/server_error.php

RewriteRule ^(config|connection)($|/) - [L,R=404]

<IfModule mod_php.c>
    php_flag display_errors on
</IfModule>

<IfModule mod_headers.c>
    <FilesMatch "\.php$">
        Header set Cache-Control "private, max-age=0, must-revalidate"
    </FilesMatch>

    <FilesMatch "\.(js)$">
        Header set Cache-Control "public, max-age=2592000"
    </FilesMatch>

    <FilesMatch "\.(png|jpg|jpeg|gif|ico|svg|css|woff2|ttf|eot|webp)$">
        Header set Cache-Control "public, max-age=604800"
    </FilesMatch>
</IfModule>

<IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    
    RewriteRule ^(.*)$ $1.php
    
    RewriteCond %{ENV:REDIRECT_STATUS} ^$
    RewriteCond %{REQUEST_URI} !^/BodegaCopeco/error/
    RewriteCond %{REQUEST_URI} !^/BodegaCopeco/service-worker\.js$
    RewriteCond %{REQUEST_URI} !^/BodegaCopeco/src/img/icon_192x192.png$
    RewriteCond %{REQUEST_URI} !^/BodegaCopeco/src/img/logo_2.jpg$
    RewriteRule ^ - [CO=old_url:%{REQUEST_URI}:localhost]
</IfModule>

Options -Indexes