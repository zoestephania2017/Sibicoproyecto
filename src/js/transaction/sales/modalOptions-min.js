import{setModalTitle,setNameModalButton,setFormReadOnly}from"../../module/modal-min.js";import{alert}from"../../module/alert-min.js";import{create,destroy,read}from"../../module/services/services-min.js";export default function openModal(e,t,r,a,o,l,s,c){var d=t.row({selected:!0}).data();switch(o.querySelector("#txtAction").value){case"001":o.querySelector("#txtDate").value=(new Date).toISOString().split("T")[0],setModalTitle("modalTitle","Crear Acta de Entrega"),setNameModalButton("btnModal","Guardar datos"),l.click();break;case"005":setFormReadOnly("frmSale"),setParameters(d,o,l,"modalTitle","Ver Acta de Entrega","btnModal","Ver acta de entrega",s,c);break;default:break}}async function setParameters(e,t,r,a,o,l,s,c,d){if(!e)return void alert("Aviso","Debe seleccionar un registro.","info","OK",!1);let i=await read(`../../app/controllers/SaleController.php?sale=${e.codigo_factura}`);const u=i[0].details;t.querySelector("#txtCode").value=i[0]?.codigo_factura,t.querySelector("#txtTypeDocument").value=i[0]?.acta,t.querySelector("#txtDate").value=i[0]?.fecha_transaccion,t.querySelector("#txtReceiver").value=i[0]?.cliente,t.querySelector("#txtNote").value=i[0]?.nota,t.querySelector("#txtPhone").value=i[0]?.telefono,t.querySelector("#txtDelivery").value=i[0]?.responsable,t.querySelector("#txtInstitution").value=i[0]?.codigo_institucion,t.querySelector("#txtRTN").value=i[0]?.rtn,t.querySelector("#txtPosition").value=i[0]?.cargo,t.querySelector("#divCorrelative").classList.remove("hidden"),t.querySelector("#txtCorrelative").value=i[0]?.numero;let n=getTotal(u);if(t.querySelector("#txtTotal1").value=n,t.querySelector("#txtTotal").value=n,t.querySelector("#txtISVEx").value=i[0]?.importe_exonerado,t.querySelector("#txtISVExempt").value=i[0]?.importe_exento,t.querySelector("#txtIGV15").value=i[0]?.importe_gravado_15,t.querySelector("#txtIGV18").value=i[0]?.importe_gravado_18,t.querySelector("#txtISV15").value=i[0]?.impuesto,t.querySelector("#txtISV18").value=i[0]?.impuesto_18,i){c.push(...u);let e=d.table().container().querySelectorAll(".btn-delete");if(e&&e.length>0)for(let t=0;t<e.length;t++)e[t].classList.add("disabled");d.clear(),d.rows.add(c),d.draw()}t.querySelector(`#${l}`).disabled=!0,t.querySelector(`#${l}`).classList.add("hidden"),t.querySelector("#divCost1").classList.add("hidden"),t.querySelector("#divCost2").classList.add("hidden"),t.querySelector("#divCost3").classList.add("hidden"),t.querySelector("#divTotal").classList.remove("hidden"),t.querySelector("#btnAdd").disabled=!0,t.querySelector("#btnAdd").classList.add("hidden"),t.querySelector("#btnPrint").disabled=!1,t.querySelector("#btnPrint").classList.remove("hidden"),r.click(),setModalTitle(a,o),setNameModalButton(l,s)}function getTotal(e){let t=0;return e.forEach((e=>{t+=parseFloat(e.total)})),t}export async function send(e={},t="001"){const r="../../app/controllers/SaleController.php";if(!e)return{success:!1,message:"Los datos son requeridos."};switch(t){case"001":return await create(e,r);case"001C":return await create(e,"../../app/controllers/ClientController.php");case"002":return await destroy(e,r);default:}}