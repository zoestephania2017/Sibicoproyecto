import{alert}from"../../module/alert-min.js";import createSelectOptions from"../../module/select-min.js";import{validateNumber,validateRequired}from"../../module/validate-min.js";import{create}from"../../module/services/services-min.js";import{clearInput}from"../../module/modal-min.js";document.addEventListener("DOMContentLoaded",(async()=>{const e=document.querySelector("#frmInitial"),t=document.querySelector("#btnAdd"),r=document.querySelector("#txtBrand"),a=document.querySelector("#txtModel");let l=[];await createSelectOptions("#txtBrand","../../app/controllers/BrandController.php","codigo","nombre_marca"),await createSelectOptions("#txtSide","../../app/controllers/InitialController.php?side=true","codigo","nombre"),await createSelectOptions("#txtType","../../app/controllers/InitialController.php?type=true","codigo_tipo_producto","nombre_tipo_producto");let o=new DataTable("#tblItems",{dom:"Bfrtip",async:!0,dataSrc:l,columns:[{title:"ID",data:"code"},{title:"Marca",data:"brand"},{title:"Modelo",data:"model"},{title:"Año",data:"year"},{title:"Tipo",data:"type"},{title:"Lado",data:"side"},{title:"Articulo",data:"article"},{title:"Cantidad",data:"quantity"},{title:"Precio",data:"price"},{title:"Descripción",data:"description"}],searching:!1,select:!0,responsive:!0,paging:!0,buttons:[{text:'<i class="fa-solid fa-trash text-rose-500"></i> Eliminar',action:function(e,t,r,a){let i=t.row({selected:!0}).data();i?function(e){const t=l.findIndex((t=>t.id===e));-1!==t&&(l.splice(t,1),o.clear(),o.rows.add(l),o.draw())}(i.codigo):alert("Aviso","Debe seleccionar un registro para eliminar.","info","OK",!1)},className:"btn-delete font-bold"}],language:{url:"https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json"}});e.addEventListener("submit",(async t=>{if(t.preventDefault(),0===l.length)return void alert("Aviso","Debe ingresar al menos un registro.","info","OK",!1);let r=await create(l,"../../app/controllers/InitialController.php");if(r){let t=r?.success?"Transacción exitosa":"Error en la transacción",a=r?.success?"success":"warning";alert(t,r.message,a,"Ok",!0),r.success&&(clearInput(e),l=[],o.clear(),o.rows.add(l),o.draw())}})),r.addEventListener("change",(async t=>{let r=e.querySelector("#txtBrand").value=t.target.value;await createSelectOptions("#txtModel","../../app/controllers/InitialController.php?model="+r,"codigo","nombre_modelo")})),a.addEventListener("change",(async t=>{let r=e.querySelector("#txtModel").value=t.target.value;await createSelectOptions("#txtYear","../../app/controllers/InitialController.php?year="+r,"codigo","nombre")})),t.addEventListener("click",(()=>{if(function(){if(!validateRequired(e.querySelector("#txtBrand").value))return alert("Campo requerido","La marca es requerida.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtModel").value))return alert("Campo requerido","El modelo es requerido.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtYear").value))return alert("Campo requerido","El año es requerido.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtType").value))return alert("Campo requerido","El tipo es requerido.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtSide").value))return alert("Campo requerido","El lado es requerido.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtArticle").value))return alert("Campo requerido","El artículo es requerido.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtQuantity").value))return alert("Campo requerido","La cantidad es requerida.","warning","Ok",!0),!1;if(!validateNumber(e.querySelector("#txtQuantity").value))return alert("Tipo de dato incorrecto","La cantidad debe ser un número.","warning","Ok",!0),!1;if(!validateRequired(e.querySelector("#txtPrice").value))return alert("Campo requerido","El precio es requerido.","warning","Ok",!0),!1;if(!validateNumber(e.querySelector("#txtPrice").value))return alert("Tipo de dato incorrecto","El precio debe ser un número.","warning","Ok",!0),!1;return!0}()){let t={code:l.length+1,brand:e.querySelector("#txtBrand").options[e.querySelector("#txtBrand").selectedIndex].text,brandID:e.querySelector("#txtBrand").value,model:e.querySelector("#txtModel").options[e.querySelector("#txtModel").selectedIndex].text,modelID:e.querySelector("#txtModel").value,year:e.querySelector("#txtYear").options[e.querySelector("#txtYear").selectedIndex].text,yearID:e.querySelector("#txtYear").value,type:e.querySelector("#txtType").options[e.querySelector("#txtType").selectedIndex].text,typeID:e.querySelector("#txtType").value,side:e.querySelector("#txtSide").options[e.querySelector("#txtSide").selectedIndex].text,sideID:e.querySelector("#txtSide").value,article:e.querySelector("#txtArticle").value,quantity:e.querySelector("#txtQuantity").value,price:e.querySelector("#txtPrice").value,description:""===e.querySelector("#txtDescription").value?"N/A":e.querySelector("#txtDescription").value};l.push(t),o.clear(),o.rows.add(l),o.draw(),e.querySelector("#txtBrand").value="",e.querySelector("#txtModel").value="",e.querySelector("#txtYear").value="",e.querySelector("#txtType").value="",e.querySelector("#txtSide").value="",e.querySelector("#txtArticle").value="",e.querySelector("#txtQuantity").value="",e.querySelector("#txtPrice").value="",e.querySelector("#txtDescription").value=""}}))}));