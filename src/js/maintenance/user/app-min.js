import openModal,{send,operations}from"./modalOptions-min.js";import{clearInput}from"../../module/modal-min.js";import{alert}from"../../module/alert-min.js";import{validateRequired,validateNumber,validatePhoneNumber}from"../../module/validate-min.js";import createSelectOptions from"../../module/select-min.js";document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#modal"),t=document.querySelector("#buttonModal"),a=document.querySelector("#btnModal"),r=document.querySelector("#btnCancel"),o=document.querySelector("#frmUser"),l=document.querySelector("#txtAction"),i=document.querySelector("#btnClose");createSelectOptions("#txtProfile","../../app/controllers/ProfileController.php","codigo","nombre");let n=new DataTable("#tblUsers",{dom:"Bfrtip",async:!0,ajax:{url:"../../app/controllers/UserController.php",type:"GET",dataSrc:""},pageLength:16,loading:!0,columns:[{title:"#",data:"correlativo"},{title:"Usuario",data:"usuario"},{title:"Nombre",data:"nombre"},{title:"Apellido",data:"apellido"},{title:"Dirección",data:"direccion"},{title:"Teléfono",data:"telefono_fijo"},{title:"Movil",data:"telefono_movil"},{title:"Perfil",data:"perfil"},{title:"Estado",data:"estado",render:function(e){return`\n                        <div class="flex flex-row gap-2 items-center justify-between">\n                            <span class="text-xs w-full font-medium mr-2 px-2.5 py-0.5 rounded border ${"ACTIVO"===e?"bg-green-100 text-green-800 border-green-400":"bg-red-100 text-red-800 border-red-400"}">${e}</span>\n                        </div>\n                    `}}],select:!0,responsive:!0,paging:!0,buttons:[{text:'<i class="fa-solid fa-circle-plus text-green-500"></i> Crear',action:function(a,r,o,i){l.value="001",openModal(a,r,o,i,e,t)},className:"font-bold"},{text:'<i class="fa-solid fa-file-pen text-orange-500"></i> Editar',action:function(a,r,o,i){l.value="002",openModal(a,r,o,i,e,t)},className:"font-bold"},{text:'<i class="fa-solid fa-key text-indigo-500"></i> Reiniciar contraseña',action:function(t,r,o,i){let n=r.row({selected:!0}).data();n?(l.value="004",e.querySelector("#txtCode").value=n.correlativo,a.click()):alert("Aviso","Debe seleccionar un registro.","info","OK",!1)},className:"font-bold"},{text:'<i class="fa-solid fa-user-check text-blue-500"></i> Activar usuario',action:function(t,r,o,i){let n=r.row({selected:!0}).data();n?(l.value="005",e.querySelector("#txtCode").value=n.correlativo,a.click()):alert("Aviso","Debe seleccionar un registro.","info","OK",!1)},className:"font-bold"},{text:'<i class="fa-solid fa-trash text-red-500"></i> Eliminar',action:function(a,r,o,i){l.value="003",openModal(a,r,o,i,e,t)},className:"font-bold"},{text:'<i class="fa-solid fa-shop text-amber-500"></i> Asignar tienda',action:function(e,t,a,r){let o=t.row({selected:!0}).data();if(!o)return void alert("Aviso","Debe seleccionar un registro.","info","OK",!1);let l=o.correlativo;window.location.href=`../maintenance/user_store.php?code=${l}`},className:"font-bold"}],language:{url:"https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json"}});r.addEventListener("click",(()=>{clearInput(o)})),i.addEventListener("click",(()=>{clearInput(o)})),o.addEventListener("submit",(async a=>{a.preventDefault();let r=e.querySelector("#txtAction").value;switch(r){case"001":if(o()){let t={usuario:e.querySelector("#txtUser").value,nombre:e.querySelector("#txtName").value,apellido:e.querySelector("#txtSurname").value,direccion:e.querySelector("#txtAddress").value,telefono_fijo:e.querySelector("#txtLandlinePhone").value,telefono_movil:e.querySelector("#txtMobilePhone").value,perfil:e.querySelector("#txtProfile").value},a=await send(t,r);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}n.ajax.reload(),i.click()}else t.click();break;case"002":if(o()&&l()){let t={codigo:e.querySelector("#txtCode").value,usuario:e.querySelector("#txtUser").value,nombre:e.querySelector("#txtName").value,apellido:e.querySelector("#txtSurname").value,direccion:e.querySelector("#txtAddress").value,telefono_fijo:e.querySelector("#txtLandlinePhone").value,telefono_movil:e.querySelector("#txtMobilePhone").value,perfil:e.querySelector("#txtProfile").value},a=await send(t,r);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}n.ajax.reload(),i.click()}else t.click();break;case"003":swal("Estas seguro que deseas eliminar el usuario?",{title:"Eliminar usuario",icon:"warning",dangerMode:!0,buttons:{yes:{text:"Si",value:"yes"},not:{text:"No",value:"not"}}}).then((async a=>{switch(a){case"yes":if(l()){let t={codigo:e.querySelector("#txtCode").value},a=await send(t,r);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}n.ajax.reload(),i.click()}break;case"not":t.click();break}}));break;case"004":l()&&swal("Estas seguro que deseas reiniciar la contraseña del usuario?",{title:"Reiniciar contraseña",icon:"warning",dangerMode:!0,buttons:{yes:{text:"Si",value:"yes"},not:{text:"No",value:"not"}}}).then((async t=>{switch(t){case"yes":if(l()){let t={operation:"rstpwd",codigo:e.querySelector("#txtCode").value},a=await operations(t);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}n.ajax.reload(),i.click()}break;case"not":break}}));break;case"005":l()&&swal("Estas seguro que deseas activar el usuario?",{title:"Activar usuario",icon:"warning",dangerMode:!0,buttons:{yes:{text:"Si",value:"yes"},not:{text:"No",value:"not"}}}).then((async t=>{switch(t){case"yes":if(l()){let t={operation:"atvusr",codigo:e.querySelector("#txtCode").value},a=await operations(t);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}n.ajax.reload(),i.click()}break;case"not":break}}));break;default:break}function o(){return validateRequired(e.querySelector("#txtName").value)?validateRequired(e.querySelector("#txtSurname").value)?validateRequired(e.querySelector("#txtUser").value)?validateRequired(e.querySelector("#txtAddress").value)?validateRequired(e.querySelector("#txtLandlinePhone").value)?validatePhoneNumber(e.querySelector("#txtLandlinePhone").value)?validateRequired(e.querySelector("#txtMobilePhone").value)?validatePhoneNumber(e.querySelector("#txtMobilePhone").value)?!!validateRequired(e.querySelector("#txtProfile").value)||(alert("Campo requerido","El campo perfil es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El número de teléfono móvil no es valido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo número de teléfono móvil es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El número de teléfono fijo no es valido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo número de teléfono fijo es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo dirección es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo usuario es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo apellido es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El campo nombre es requerido.","warning","Ok",!0),!1)}function l(){return validateRequired(e.querySelector("#txtCode").value)&&!!validateNumber(e.querySelector("#txtCode").value)||(alert("Campo requerido","A ocurrido un error, por favor refresque la pagina.","warning","Ok",!0),!1)}}))}));