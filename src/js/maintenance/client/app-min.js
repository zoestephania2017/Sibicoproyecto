import openModal,{send}from"./modalOptions-min.js";import{clearInput}from"../../module/modal-min.js";import{alert}from"../../module/alert-min.js";import{validateEmail,validateNumber,validatePhoneNumber,validateRequired}from"../../module/validate-min.js";document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#modal"),t=document.querySelector("#buttonModal"),a=document.querySelector("#btnCancelEdit"),r=document.querySelector("#frmClient"),o=document.querySelector("#txtAction"),l=document.querySelector("#btnClose");let i=new DataTable("#tblClients",{dom:"Bfrtip",async:!0,ajax:{url:"../../app/controllers/ClientController.php",type:"GET",dataSrc:""},pageLength:15,loading:!0,columns:[{title:"Codigo",data:"codigo"},{title:"Nombre",data:"nombre"},{title:"Apellido",data:"apellido"},{title:"Dirección",data:"direccion"},{title:"Correo",data:"correo"},{title:"Teléfono",data:"telefono_fijo"},{title:"Movil",data:"telefono_movil"}],select:!0,responsive:!0,paging:!0,buttons:[{text:'<i class="fa-solid fa-circle-plus text-green-500"></i> Crear',action:function(a,r,l,i){o.value="001",openModal(a,r,l,i,e,t)},className:"font-bold"},{text:'<i class="fa-solid fa-file-pen text-orange-500"></i> Editar',action:function(a,r,l,i){o.value="002",openModal(a,r,l,i,e,t)},className:"font-bold"},{text:'<i class="fa-solid fa-trash text-red-500"></i> Eliminar',action:function(a,r,l,i){o.value="003",openModal(a,r,l,i,e,t)},className:"font-bold"}],language:{url:"https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json"}});a.addEventListener("click",(()=>{clearInput(r)})),l.addEventListener("click",(()=>{clearInput(r)})),r.addEventListener("submit",(async a=>{a.preventDefault();let r=e.querySelector("#txtAction").value;switch(r){case"001":if(o()){const t={nombre:e.querySelector("#txtName").value,apellido:e.querySelector("#txtLastName").value,direccion:e.querySelector("#txtAddress").value,correo:e.querySelector("#txtEmail").value,telefono_fijo:e.querySelector("#txtPhone1").value||"N/A",telefono_movil:e.querySelector("#txtPhone2").value||"N/A"};let a=await send(t,r);if(a){let e=a?.success?"Transacción exitosa":"Error en la transacción",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}i.ajax.reload()}break;case"002":if(o()&&n()){const t={codigo:e.querySelector("#txtCode").value,nombre:e.querySelector("#txtName").value,apellido:e.querySelector("#txtLastName").value,direccion:e.querySelector("#txtAddress").value,correo:e.querySelector("#txtEmail").value,telefono_fijo:e.querySelector("#txtPhone1").value,telefono_movil:e.querySelector("#txtPhone2").value};let a=await send(t,r);if(a){let e=a?.success?"Transacción exitosa":"Error en la transaccion",t=a?.success?"success":"warning";alert(e,a.message,t,"Ok",!0)}i.ajax.reload()}break;case"003":swal("Estas seguro que deseas eliminar el cliente?",{title:"Eliminar cliente",icon:"warning",dangerMode:!0,buttons:{yes:{text:"Si",value:"yes"},not:{text:"No",value:"not"}}}).then((async e=>{switch(e){case"yes":if(n()){let e={codigo:modal.querySelector("#txtCode").value},t=await send(e,r);if(t){let e=t?.success?"Transaccion exitosa":"Error en la transaccion",a=t?.success?"success":"warning";alert(e,t.message,a,"Ok",!0)}i.ajax.reload(),l.click()}break;case"not":t.click();break}}));break;default:}function o(){return validateRequired(e.querySelector("#txtName").value)?validateRequired(e.querySelector("#txtLastName").value)?validateRequired(e.querySelector("#txtAddress").value)?validateRequired(e.querySelector("#txtEmail").value)?validateEmail(e.querySelector("#txtEmail").value)?!!validateRequired(e.querySelector("#txtAction").value)||(alert("Error","Por favor refresque la pagina.","warning","Ok",!0),!1):(alert("Campo requerido","El correo electrónico no es valido.","warning","Ok",!0),!1):(alert("Campo requerido","El correo electrónico es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","La dirección es requerida.","warning","Ok",!0),!1):(alert("Campo requerido","El apellido es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El nombre es requerido.","warning","Ok",!0),!1)}function n(){return validateRequired(modal.querySelector("#txtCode").value)&&!!validateNumber(modal.querySelector("#txtCode").value)||(alert("Campo requerido","A ocurrido un error, por favor refresque la pagina.","warning","Ok",!0),!1)}t.click()}))}));