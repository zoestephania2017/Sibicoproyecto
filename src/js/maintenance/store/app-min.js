import openModal,{send}from"./modalOptions-min.js";import{clearInput}from"../../module/modal-min.js";import{alert}from"../../module/alert-min.js";import{validateNumber,validatePhoneNumber,validateRequired,validateDate}from"../../module/validate-min.js";document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#modal"),r=document.querySelector("#buttonModal"),t=document.querySelector("#btnCancel"),a=document.querySelector("#frmStore"),o=document.querySelector("#txtAction"),l=document.querySelector("#btnClose");let i=new DataTable("#tblStores",{dom:"Bfrtip",async:!0,ajax:{url:"../../app/controllers/StoreController.php",type:"GET",dataSrc:""},pageLength:16,loading:!0,columns:[{title:"Codigo",data:"codigo"},{title:"Nombre",data:"nombre"},{title:"Dirección",data:"direccion"},{title:"RTN",data:"rtn"},{title:"Teléfono",data:"telefono"},{title:"Tipo",data:"tipo"},{title:"Estado",data:"estado",render:function(e){return`\n                    <div class="flex flex-row gap-2 items-center justify-between">\n                        <span class="text-xs w-full font-medium mr-2 px-2.5 py-0.5 rounded border ${"ACTIVO"===e?"bg-green-100 text-green-800 border-green-400":"bg-red-100 text-red-800 border-red-400"}">${e}</span>\n                    </div>\n                `}}],select:!0,responsive:!0,paging:!0,buttons:[{text:'<i class="fa-solid fa-circle-plus text-green-500"></i> Crear',action:function(t,a,l,i){o.value="001",openModal(t,a,l,i,e,r)},className:"font-bold"},{text:'<i class="fa-solid fa-file-pen text-orange-500"></i> Editar',action:function(t,a,l,i){o.value="002",openModal(t,a,l,i,e,r)},className:"font-bold"},{text:'<i class="fa-solid fa-trash text-red-500"></i> Eliminar',action:function(t,a,l,i){o.value="003",openModal(t,a,l,i,e,r)},className:"font-bold"}],language:{url:"https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json"}});t.addEventListener("click",(()=>{clearInput(a)})),l.addEventListener("click",(()=>{clearInput(a)})),a.addEventListener("submit",(async t=>{t.preventDefault();let a=e.querySelector("#txtAction").value;switch(a){case"001":if(o()){let r={nombre:e.querySelector("#txtName").value,direccion:e.querySelector("#txtAddress").value,rtn:e.querySelector("#txtRTN").value,telefono:e.querySelector("#txtPhone").value,fecha_limite_emision:e.querySelector("#txtDate").value,cai:e.querySelector("#txtManager").value,orden_compra:e.querySelector("#txtOrder").value,exoneraciones:e.querySelector("#txtExonerations").value,agricultura:e.querySelector("#txtAgriculture").value,facturai:e.querySelector("#txtInvoiceInit").value,facturaf:e.querySelector("#txtInvoiceEnd").value,tipo:e.querySelector("#txtType").value},t=await send(r,a);if(t){let e=t?.success?"Transacción exitosa":"Error en la transacción",r=t?.success?"success":"warning";alert(e,t.message,r,"Ok",!0)}i.ajax.reload()}break;case"002":if(o()&&n()){let r={codigo:e.querySelector("#txtCode").value,nombre:e.querySelector("#txtName").value,direccion:e.querySelector("#txtAddress").value,rtn:e.querySelector("#txtRTN").value,telefono:e.querySelector("#txtPhone").value,fecha_limite_emision:e.querySelector("#txtDate").value,cai:e.querySelector("#txtManager").value,orden_compra:e.querySelector("#txtOrder").value,exoneraciones:e.querySelector("#txtExonerations").value,agricultura:e.querySelector("#txtAgriculture").value,facturai:e.querySelector("#txtInvoiceInit").value,facturaf:e.querySelector("#txtInvoiceEnd").value,tipo:e.querySelector("#txtType").value},t=await send(r,a);if(t){let e=t?.success?"Transacción exitosa":"Error en la transaccion",r=t?.success?"success":"warning";alert(e,t.message,r,"Ok",!0)}i.ajax.reload()}break;case"003":swal("Estas seguro que deseas eliminar la tienda?",{title:"Eliminar tienda",icon:"warning",dangerMode:!0,buttons:{yes:{text:"Si",value:"yes"},not:{text:"No",value:"not"}}}).then((async t=>{switch(t){case"yes":if(n()){let r={codigo:e.querySelector("#txtCode").value},t=await send(r,a);if(t){let e=t?.success?"Transacción exitosa":"Error en la transaccion",r=t?.success?"success":"warning";alert(e,t.message,r,"Ok",!0)}i.ajax.reload(),l.click()}break;case"not":r.click();break}}));break;default:break}function o(){return validateRequired(e.querySelector("#txtName").value)?validateRequired(e.querySelector("#txtRTN").value)?validateRequired(e.querySelector("#txtAddress").value)?validateRequired(e.querySelector("#txtPhone").value)?validatePhoneNumber(e.querySelector("#txtPhone").value)?validateRequired(e.querySelector("#txtDate").value)?validateDate(e.querySelector("#txtDate").value)?validateRequired(e.querySelector("#txtManager").value)?validateRequired(e.querySelector("#txtOrder").value)?validateRequired(e.querySelector("#txtExonerations").value)?validateRequired(e.querySelector("#txtAgriculture").value)?validateRequired(e.querySelector("#txtInvoiceInit").value)?validateRequired(e.querySelector("#txtInvoiceEnd").value)?validateRequired(e.querySelector("#txtType").value)?!!validateRequired(e.querySelector("#txtAction").value)||(alert("Error","Por favor refresque la pagina.","warning","Ok",!0),!1):(alert("Campo requerido","El tipo de bodega es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El registro de factura final es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El registro de factura inicial es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El registro de agricultura es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El registro de exoneraciones es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El correlativo de orden de compra exenta es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El jefe de bodega es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","La fecha es incorrecta.","warning","Ok",!0),!1):(alert("Campo requerido","La fecha es requerida.","warning","Ok",!0),!1):(alert("Campo requerido","El número de teléfono es incorrecto.","warning","Ok",!0),!1):(alert("Campo requerido","El número de teléfono es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","La dirección es requerida.","warning","Ok",!0),!1):(alert("Campo requerido","El RTN es requerido.","warning","Ok",!0),!1):(alert("Campo requerido","El nombre es requerido.","warning","Ok",!0),!1)}function n(){return validateRequired(e.querySelector("#txtCode").value)&&!!validateNumber(e.querySelector("#txtCode").value)||(alert("Campo requerido","A ocurrido un error, por favor refresque la pagina.","warning","Ok",!0),!1)}r.click()}))}));